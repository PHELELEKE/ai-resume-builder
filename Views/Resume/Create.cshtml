@model AIResumeBuilder.Models.Resume


@{
    ViewData["Title"] = "Create Resume";
}


<div class="container">
    <h2>Create Your AI-Powered Resume</h2>
    
    @{
    var template = ViewBag.Template as string ?? "Professional";
    var templateClass = $"template-{template.ToLower()}";
}

<div class="@templateClass">
    <form asp-action="Create" method="post" id="resumeForm">
        @Html.AntiForgeryToken()
        
        <div class="row">
            <!-- Personal Information -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Personal Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label asp-for="FullName" class="form-label"></label>
                            <input asp-for="FullName" class="form-control" placeholder="Enter your full name" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" placeholder="your.email@example.com" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label asp-for="Phone" class="form-label"></label>
                            <input asp-for="Phone" class="form-control" placeholder="123-456-7890" />
                            <span asp-validation-for="Phone" class="text-danger"></span>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label asp-for="TargetJobTitle" class="form-label"></label>
                            <input asp-for="TargetJobTitle" class="form-control" placeholder="e.g., Software Developer" />
                            <span asp-validation-for="TargetJobTitle" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Professional Summary -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Professional Summary</h5>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="generateAIContent('summary')">
                            ü§ñ AI Generate
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label asp-for="Summary" class="form-label"></label>
                            <textarea asp-for="Summary" class="form-control" rows="6" id="summaryText" 
                                      placeholder="Describe your professional background, skills, and career objectives..."></textarea>
                            <span asp-validation-for="Summary" class="text-danger"></span>
                            <small class="form-text text-muted">Brief overview of your professional background</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Education Section -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5>Education</h5>
                <button type="button" class="btn btn-success btn-sm" onclick="addEducation()">
                    + Add Education
                </button>
            </div>
            <div class="card-body">
                <div id="educationSection">
                    <!-- First education item -->
                    <div class="education-item border p-3 mb-3">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label class="form-label">Institution</label>
                                    <input name="Educations[0].Institution" class="form-control" placeholder="University Name" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label class="form-label">Degree</label>
                                    <input name="Educations[0].Degree" class="form-control" placeholder="Bachelor's, Master's, etc." />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label class="form-label">Field of Study</label>
                                    <input name="Educations[0].Field" class="form-control" placeholder="Computer Science, Business, etc." />
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group mb-3">
                                    <label class="form-label">Graduation Year</label>
                                    <input name="Educations[0].GraduationYear" class="form-control" type="number" placeholder="2023" />
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
                    </div>
                </div>
            </div>
        </div>

       <!-- Work Experience Section -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>Work Experience</h5>
        <button type="button" class="btn btn-success btn-sm" onclick="addExperience()">
            + Add Experience
        </button>
    </div>
    <div class="card-body">
        <div id="experienceSection">
            <!-- First experience item -->
            <div class="experience-item border p-3 mb-3">
                <div class="row">
                    <div class="col-md-5">
                        <div class="form-group mb-3">
                            <label class="form-label">Company *</label>
                            <input name="Experiences[0].Company" class="form-control" placeholder="Company Name" required />
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group mb-3">
                            <label class="form-label">Position *</label>
                            <input name="Experiences[0].Position" class="form-control" placeholder="Job Title" required />
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group mb-3">
                            <label class="form-label">Start Year *</label>
                            <input name="Experiences[0].StartDate" class="form-control" type="number" placeholder="2020" min="1900" max="2030" required />
                        </div>
                    </div>
                </div>
                <div class="form-group mb-3">
                    <label class="form-label">Description *</label>
                    <textarea name="Experiences[0].Description" class="form-control" rows="3" placeholder="Describe your responsibilities and achievements..." required></textarea>
                </div>
                <div class="form-group mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="Experiences[0].IsCurrent" id="exp0Current" onchange="toggleEndDate(0)">
                        <label class="form-check-label" for="exp0Current">
                            I currently work here
                        </label>
                    </div>
                </div>
                <div class="form-group mb-3" id="endDateGroup0">
                    <label class="form-label">End Year</label>
                    <input name="Experiences[0].EndDate" class="form-control" type="number" placeholder="2023" min="1900" max="2030" />
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
            </div>
        </div>
    </div>
</div>

<!-- Skills Section -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>Skills</h5>
        <button type="button" class="btn btn-success btn-sm" onclick="addSkill()">
            + Add Skill
        </button>
    </div>
    <div class="card-body">
        <div id="skillsSection">
            <!-- First skill item -->
            <div class="skill-item border p-3 mb-3">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label class="form-label">Skill Name *</label>
                            <input name="Skills[0].Name" class="form-control" placeholder="e.g., JavaScript, Project Management" required />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label class="form-label">Level *</label>
                            <select name="Skills[0].Level" class="form-control" required>
                                <option value="">Select Level</option>
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                                <option value="Expert">Expert</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label class="form-label">Category</label>
                            <input name="Skills[0].Category" class="form-control" placeholder="Technical, Soft, etc." />
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
            </div>
        </div>
    </div>
</div>

        <!-- Template Selection -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Choose Resume Template</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="template-option text-center">
                    <input type="radio" asp-for="Template" value="Professional" id="template1" checked class="d-none">
                    <label for="template1" class="template-label border rounded p-3 d-block">
                        <div class="template-preview mb-2">
                            <div style="height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                Professional
                            </div>
                        </div>
                        <h6>Professional</h6>
                        <small class="text-muted">Clean and corporate style</small>
                    </label>
                </div>
            </div>
            <div class="col-md-4">
                <div class="template-option text-center">
                    <input type="radio" asp-for="Template" value="Modern" id="template2" class="d-none">
                    <label for="template2" class="template-label border rounded p-3 d-block">
                        <div class="template-preview mb-2">
                            <div style="height: 120px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                Modern
                            </div>
                        </div>
                        <h6>Modern</h6>
                        <small class="text-muted">Creative with colors</small>
                    </label>
                </div>
            </div>
            <div class="col-md-4">
                <div class="template-option text-center">
                    <input type="radio" asp-for="Template" value="Classic" id="template3" class="d-none">
                    <label for="template3" class="template-label border rounded p-3 d-block">
                        <div class="template-preview mb-2">
                            <div style="height: 120px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                Classic
                            </div>
                        </div>
                        <h6>Classic</h6>
                        <small class="text-muted">Traditional layout</small>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

        <div class="form-group text-center">
            <button type="submit" class="btn btn-primary btn-lg">Generate Resume</button>
            <a href="@Url.Action("Index", "Home")" class="btn btn-secondary btn-lg">Cancel</a>
        </div>
    </form>
</div>
<style>
     
    .template-label {
    cursor: pointer;
    transition: all 0.3s ease;
}

.template-label:hover {
    border-color: #007bff !important;
    transform: translateY(-2px);
}

input[type="radio"]:checked + .template-label {
    border-color: #007bff !important;
    background-color: #f8f9fa;
    box-shadow: 0 0 0 2px rgba(0,123,255,.25);
}

    .template-modern .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
    }
    
    .template-classic .card-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
        color: white !important;
    }
    
    .template-professional .card-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%) !important;
        color: white !important;
    }


</style>

@section Scripts {
    <script>
        let educationCount = 1;
        let experienceCount = 1;
        let skillCount = 1;

        console.log("Create page loaded - dynamic sections enabled");

        function addEducation() {
            const html = `
                <div class="education-item border p-3 mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label class="form-label">Institution *</label>
                                <input name="Educations[${educationCount}].Institution" class="form-control" placeholder="University Name" required />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group mb-3">
                                <label class="form-label">Degree *</label>
                                <input name="Educations[${educationCount}].Degree" class="form-control" placeholder="Bachelor's, Master's, etc." required />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group mb-3">
                                <label class="form-label">Field of Study *</label>
                                <input name="Educations[${educationCount}].Field" class="form-control" placeholder="Computer Science, Business, etc." required />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group mb-3">
                                <label class="form-label">Graduation Year *</label>
                                <input name="Educations[${educationCount}].GraduationYear" class="form-control" type="number" placeholder="2023" required />
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
                </div>
            `;
            document.getElementById('educationSection').insertAdjacentHTML('beforeend', html);
            educationCount++;
            console.log(`Added education section, count: ${educationCount}`);
        }

        function addExperience() {
            const html = `
                <div class="experience-item border p-3 mb-3">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label class="form-label">Company *</label>
                                <input name="Experiences[${experienceCount}].Company" class="form-control" placeholder="Company Name" required />
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-group mb-3">
                                <label class="form-label">Position *</label>
                                <input name="Experiences[${experienceCount}].Position" class="form-control" placeholder="Job Title" required />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group mb-3">
                                <label class="form-label">Start Year *</label>
                                <input name="Experiences[${experienceCount}].StartDate" class="form-control" type="number" placeholder="2020" min="1900" max="2030" required />
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <label class="form-label">Description *</label>
                        <textarea name="Experiences[${experienceCount}].Description" class="form-control" rows="3" placeholder="Describe your responsibilities and achievements..." required></textarea>
                    </div>
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="Experiences[${experienceCount}].IsCurrent" id="exp${experienceCount}Current" onchange="toggleEndDate(${experienceCount})">
                            <label class="form-check-label" for="exp${experienceCount}Current">
                                I currently work here
                            </label>
                        </div>
                    </div>
                    <div class="form-group mb-3" id="endDateGroup${experienceCount}">
                        <label class="form-label">End Year</label>
                        <input name="Experiences[${experienceCount}].EndDate" class="form-control" type="number" placeholder="2023" min="1900" max="2030" />
                    </div>
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
                </div>
            `;
            document.getElementById('experienceSection').insertAdjacentHTML('beforeend', html);
            experienceCount++;
            console.log(`Added experience section, count: ${experienceCount}`);
        }

        function addSkill() {
            const html = `
                <div class="skill-item border p-3 mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label class="form-label">Skill Name *</label>
                                <input name="Skills[${skillCount}].Name" class="form-control" placeholder="e.g., JavaScript, Project Management" required />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label class="form-label">Level *</label>
                                <select name="Skills[${skillCount}].Level" class="form-control" required>
                                    <option value="">Select Level</option>
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                    <option value="Expert">Expert</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label class="form-label">Category</label>
                                <input name="Skills[${skillCount}].Category" class="form-control" placeholder="Technical, Soft, etc." />
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
                </div>
            `;
            document.getElementById('skillsSection').insertAdjacentHTML('beforeend', html);
            skillCount++;
            console.log(`Added skill section, count: ${skillCount}`);
        }

        function toggleEndDate(index) {
            const endDateGroup = document.getElementById(`endDateGroup${index}`);
            const checkbox = document.querySelector(`input[name="Experiences[${index}].IsCurrent"]`);
            
            if (checkbox.checked) {
                endDateGroup.style.display = 'none';
                // Clear end date when "current job" is checked
                document.querySelector(`input[name="Experiences[${index}].EndDate"]`).value = '';
            } else {
                endDateGroup.style.display = 'block';
            }
        }

        // Initialize end date visibility
        document.addEventListener('DOMContentLoaded', function() {
            toggleEndDate(0); // Initialize for first experience item
        });

        async function generateAIContent(section) {
            const jobTitle = document.querySelector('#TargetJobTitle').value;
            const currentContent = document.querySelector('#summaryText').value;
            
            if (!jobTitle) {
                alert('Please enter a target job title first');
                return;
            }

            try {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Generating...';
                button.disabled = true;

                const response = await fetch('/Resume/GenerateAIContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        section: section,
                        currentContent: currentContent,
                        jobTitle: jobTitle
                    })
                });

                const data = await response.json();
                button.innerHTML = originalText;
                button.disabled = false;

                if (data.success) {
                    document.querySelector('#summaryText').value = data.content;
                } else {
                    alert('Error generating AI content: ' + data.error);
                }
            } catch (error) {
                console.error('Error generating AI content:', error);
                alert('Error generating AI content. Please try again.');
                const button = event.target;
                button.innerHTML = 'ü§ñ AI Generate';
                button.disabled = false;
            }
        }
    
    </script>
}